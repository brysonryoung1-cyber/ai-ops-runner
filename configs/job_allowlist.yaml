---
# Allowlisted job types for ai-ops-runner.
# Only jobs defined here can be executed by the runner.
# argv is the exact command; callers cannot override it.
# allowed_params: list of parameter keys the caller may supply (env-var injected).
# requires_repo_allowlist: if true, remote_url must match configs/repo_allowlist.yaml.

jobs:
  local_echo:
    argv: ["bash", "-lc", "echo hello && uname -a"]
    timeout_sec: 60

  orb_ops_selftests:
    argv: ["bash", "-lc", "./ops/tests/review_auto_selftest.sh && ./ops/tests/ship_auto_selftest.sh"]
    timeout_sec: 1800

  orb_review_auto_nopush:
    argv: ["bash", "-lc", "./ops/review_auto.sh --no-push"]
    timeout_sec: 1800

  # --- ORB integration jobs (read-only, repo-allowlisted) ---

  orb_review_bundle:
    argv: ["bash", "/app/orb_wrappers/orb_review_bundle.sh"]
    timeout_sec: 1800
    allowed_params: ["since_sha"]
    requires_repo_allowlist: true

  orb_doctor:
    argv: ["bash", "/app/orb_wrappers/orb_doctor.sh"]
    timeout_sec: 600
    requires_repo_allowlist: true

  orb_score_run:
    argv: ["bash", "/app/orb_wrappers/orb_score_run.sh"]
    timeout_sec: 1800
    allowed_params: ["logs_day", "run_id"]
    requires_repo_allowlist: true

  # --- Soma Kajabi Library Ownership jobs ---

  soma_snapshot_home:
    argv: ["python3", "-m", "services.soma_kajabi_sync.snapshot", "--product", "Home User Library"]
    timeout_sec: 120

  soma_snapshot_practitioner:
    argv: ["python3", "-m", "services.soma_kajabi_sync.snapshot", "--product", "Practitioner Library"]
    timeout_sec: 120

  soma_harvest:
    argv: ["python3", "-m", "services.soma_kajabi_sync.harvest"]
    timeout_sec: 180

  soma_mirror:
    argv: ["python3", "-m", "services.soma_kajabi_sync.mirror", "--dry-run"]
    timeout_sec: 60

  soma_smoke:
    argv: ["bash", "./ops/soma_smoke.sh"]
    timeout_sec: 120

  soma_kajabi_discover:
    argv: ["python3", "./ops/scripts/kajabi_discover.py"]
    timeout_sec: 180

  # Offline canary: Karpathy microgpt (fetch pinned + SHA256, patch, run). No LLM providers.
  llm.microgpt.canary:
    argv: ["bash", "./ops/scripts/microgpt_canary.sh"]
    timeout_sec: 90
