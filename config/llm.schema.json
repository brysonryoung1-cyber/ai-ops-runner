{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OpenClaw LLM Provider Configuration",
  "description": "Configuration for LLM providers, routing, budget caps, and review fallback. Review gate primary is always OpenAI (fail-closed); Mistral Codestral is the fallback reviewer.",
  "type": "object",
  "required": ["enabledProviders", "defaults", "providers"],
  "additionalProperties": false,
  "properties": {
    "$schema": { "type": "string" },
    "enabledProviders": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": ["openai", "mistral", "moonshot", "ollama"]
      },
      "contains": { "const": "openai" },
      "description": "List of enabled providers. 'openai' is always required (review gate primary)."
    },
    "defaults": {
      "type": "object",
      "required": ["general", "review"],
      "additionalProperties": false,
      "properties": {
        "general": { "$ref": "#/definitions/purposeRoute" },
        "review": {
          "type": "object",
          "required": ["provider", "model"],
          "additionalProperties": false,
          "properties": {
            "provider": { "type": "string", "const": "openai", "description": "Review primary MUST use OpenAI (fail-closed, non-negotiable)" },
            "model": { "type": "string", "minLength": 1 }
          }
        },
        "vision": { "$ref": "#/definitions/purposeRoute" }
      },
      "description": "Default provider + model for each purpose. review.provider MUST be 'openai'."
    },
    "reviewFallback": {
      "type": "object",
      "required": ["provider", "model"],
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["mistral", "moonshot"],
          "description": "Fallback reviewer provider (NOT openai â€” that's the primary)"
        },
        "model": { "type": "string", "minLength": 1 }
      },
      "description": "Fallback reviewer when OpenAI returns quota/rate/5xx/timeout. Must be a non-OpenAI code-specialized model."
    },
    "budget": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "maxUsdPerReview": {
          "type": "number",
          "minimum": 0.01,
          "description": "Maximum USD per review call. Fail-closed: review refused if estimate exceeds."
        },
        "maxUsdPerRun": {
          "type": "number",
          "minimum": 0.01,
          "description": "Maximum USD per run (all LLM calls in a session)."
        },
        "pricing": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "required": ["inputPer1M", "outputPer1M"],
            "additionalProperties": false,
            "properties": {
              "inputPer1M": { "type": "number", "minimum": 0, "description": "Cost per 1M input tokens (USD)" },
              "outputPer1M": { "type": "number", "minimum": 0, "description": "Cost per 1M output tokens (USD)" }
            }
          },
          "description": "Per-model pricing table (USD per 1M tokens)."
        }
      },
      "description": "Budget caps and pricing. Cost estimated before each call; refused if over cap (fail-closed for gates)."
    },
    "reviewCaps": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "maxOutputTokens": {
          "type": "integer",
          "minimum": 100,
          "maximum": 4096,
          "description": "Hard cap on review response tokens. Default 600."
        },
        "temperature": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Temperature for review calls. Default 0 (deterministic)."
        }
      },
      "description": "Strict caps for review gate API calls."
    },
    "providers": {
      "type": "object",
      "required": ["openai"],
      "additionalProperties": false,
      "properties": {
        "openai": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "apiBase": { "type": "string", "format": "uri" },
            "keySource": { "type": "string" },
            "keyEnv": { "type": "string" },
            "enabled": { "type": "boolean" }
          }
        },
        "mistral": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "apiBase": { "type": "string", "format": "uri" },
            "keyEnv": { "type": "string" },
            "keySource": { "type": "string" },
            "enabled": { "type": "boolean" }
          }
        },
        "moonshot": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "apiBase": { "type": "string", "format": "uri" },
            "keyEnv": { "type": "string" },
            "keySource": { "type": "string" },
            "enabled": { "type": "boolean" }
          }
        },
        "ollama": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "apiBase": {
              "type": "string",
              "pattern": "^https?://(127\\.0\\.0\\.1|localhost|\\[::1\\])",
              "description": "MUST be localhost-only (private-only invariant)"
            },
            "keyEnv": { "type": "string" },
            "keySource": { "type": "string" },
            "enabled": { "type": "boolean" }
          }
        }
      }
    }
  },
  "definitions": {
    "purposeRoute": {
      "type": "object",
      "required": ["provider", "model"],
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["openai", "mistral", "moonshot", "ollama"]
        },
        "model": {
          "type": "string",
          "minLength": 1
        }
      }
    }
  }
}
